import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from matplotlib.colors import LinearSegmentedColormap

# ---------------- user config ----------------
excel_path = r"C\Supporting Input Dataset.xlsx"  # <- modify to your file path
sheet_name = "Sheet1"   # <- if not Sheet1, change to your sheet name
figsize = (12, 10)
tick_fontsize = 8       # set to 6-8 if many features
# ---------------------------------------------

# Read data (assuming data is numerical feature table, first row contains column names)
df = pd.read_excel(excel_path, sheet_name=sheet_name)
numeric_df = df.select_dtypes(include=[np.number])  # use only numerical columns for correlation
cols = numeric_df.columns.tolist()

# Calculate Pearson correlation coefficient matrix
corr = numeric_df.corr(method="pearson")

# Custom colormap from blue → light blue → white → orange → red
colors = ["#3D50C4", "#7497f4", "#FFFFFF", "#E27557", "#B7132A"]
cmap = LinearSegmentedColormap.from_list("lightblue_blue_white_red_orange", colors)

# Set global font to Arial
plt.rcParams["font.family"] = "Arial"
plt.rcParams["font.sans-serif"] = ["Arial"]
plt.rcParams["axes.unicode_minus"] = False

# Plot
plt.figure(figsize=figsize)
ax = sns.heatmap(
    corr,
    cmap=cmap,
    center=0,          # white at center
    vmin=-1,
    vmax=1,
    annot=True,        # ✅ display values
    fmt=".2f",         # values with 2 decimal places
    annot_kws={"size": 10, "fontweight": "bold", "fontname": "Arial"},  # ✅ larger value font + bold + Arial
    linewidths=0,      # no gaps between color blocks
    linecolor=None,
    square=False,
    cbar_kws={"shrink": 0.8, "label": "Pearson r"}
)

# Ensure all labels are displayed with Arial font
ax.set_xticks(np.arange(len(cols)) + 0.5)
ax.set_yticks(np.arange(len(cols)) + 0.5)
ax.set_xticklabels(cols, rotation=90, ha="center", fontsize=tick_fontsize, fontname="Arial")
ax.set_yticklabels(cols, rotation=0, fontsize=tick_fontsize, fontname="Arial")

plt.title("Pearson Correlation Heatmap", fontsize=14, fontname="Arial", fontweight="bold")
plt.tight_layout()

# Optional: save image to desktop (uncomment and modify path)
# save_path = r"C:\Users\Administrator\Desktop\pearson_heatmap_gradient.png"
# plt.savefig(save_path, dpi=300)

plt.show()
